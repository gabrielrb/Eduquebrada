<div class="mt-4 mx-4">
  <div class="pt-5">
    <div class="d-flex justify-content-center">
      <h1><%= @lesson.name %></h1>
    </div>
  </div>

  <br>

  <div class="lesson-page">
    <div>
      <div>
        <iframe width="100%" height="400" src="<%= @lesson.url %>" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
      </div>
      <div>
        <% if policy(@lesson).create? %>
          <%= @lesson.name %>
          <%= @lesson.description %>
        <% end %>
      </div>

      <br>

      <div class="align-self-end mr-3 d-flex">
        <% if current_user == @lesson.course.user %>
          <div class="justify-content-between">
            <%= link_to "Editar aula", edit_lesson_path, class: "btn btn-primary" %>
            <% if policy(@lesson).destroy? %>
              <%= link_to "Deletar aula", lesson_path(@lesson), method: :delete, class: "btn btn-primary" %>
            <% end %>
            <%= link_to "Voltar ao curso", course_path(@lesson.course), class: "btn btn-primary" %>
          </div>
        <% else %>
            <%= link_to "Voltar ao curso", course_path(@lesson.course), class: "btn btn-primary" %>
        <% end %>
      </div>
    </div>

    <div>
      <div class="lessons-index">
        <% @lessons.each do |lesson| %>
          <details>
            <summary class="border-bottom">
                <%= link_to lesson.name, lesson_path(lesson) %>
            </summary>
          </details>
        <% end %>
      </div>
      <br>
      <div>
        <%= simple_form_for([ @lesson, @comment ], remote: true) do |f| %>
          <%= f.input :content, as: :text, placeholder: "Teve alguma dúvida sobre o conteúdo da aula? Deixe aqui sua dúvida!", label: false %>
          <%= f.button :submit, class: "btn btn-primary" %>
        <% end %>
      </div>
      <br>
      <div>
        <h4>
          <%= pluralize @lesson.comments.size, "comentário" %>
        </h4>
        <div id="comments">
          <% if @lesson.comments.blank? %>
            Seja o primeiro a deixar um comentário.
          <% else %>
            <% @lesson.comments.each do |comment| %>
              <p id="comment-<%= comment.id %>"><strong><%= comment.user.email %>:</strong> <%= comment.content %></p>
              <div id="replies">
                <% unless comment.replies.blank? %>
                  <% comment.replies.each do |reply| %>
                    <p id="reply-<%= reply.id %>"><strong><%= reply.user.email %>:</strong> <%= reply.content %></p></p>
                  <% end %>
                <% end %>
              </div>
              <%= simple_form_for([ @lesson, comment, @reply ], remote: true) do |f| %>
                <%= f.input :content, as: :text %>
                <%= f.button :submit, class: "btn btn-primary" %>
              <% end %>
            <% end %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>

